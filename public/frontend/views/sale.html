<div class="page">

    <!-- PAGE HEADER -->
    <div class="page-header">
        <div>
            <h4>Sales Entry</h4>
            <p class="page-subtitle">Create new sales invoice</p>
        </div>

        <div class="page-actions">
            <button class="btn btn-outline-secondary"
                    ng-click="$location.path('/sales')">
                Back to List
            </button>
        </div>
    </div>

    <!-- SALE HEADER -->
    <div class="card mb-3">
        <div class="form-grid">

            <div>
                <label>Customer</label>
                <select class="form-control"
                        ng-model="sale.party_id"
                        ng-options="p.id as p.name for p in parties"
                        required>
                    <option value="">Select Customer</option>
                </select>
            </div>

            <div>
                <label>Invoice Date</label>
                <input type="date"
                       class="form-control"
                       ng-model="sale.invoice_date">
            </div>

        </div>
    </div>

    <!-- ITEMS -->
    <div class="card">

        <table class="table munim-table">
            <thead>
                <tr>
                    <th style="width:30%">Product</th>
                    <th class="text-right">Weight (gm)</th>
                    <th class="text-right">Rate</th>
                    <th class="text-right">Amount</th>
                    <th></th>
                </tr>
            </thead>

            <tbody>
                <tr ng-repeat="item in sale.items">

                    <td>
                        <select class="form-control"
                                ng-model="item.product_id"
                                ng-options="p.id as p.name for p in products">
                            <option value="">Select Product</option>
                        </select>
                    </td>

                    <td>
                        <input type="number"
                               step="0.001"
                               class="form-control text-right"
                               ng-model="item.weight"
                               ng-change="calc(item)">
                    </td>

                    <td>
                        <input type="number"
                               class="form-control text-right"
                               ng-model="item.rate"
                               ng-change="calc(item)">
                    </td>

                    <td class="text-right">
                        ₹ {{ item.amount | number:2 }}
                    </td>

                    <td class="text-center">
                        <button class="btn btn-sm btn-danger"
                                ng-click="removeItem($index)">
                            ✕
                        </button>
                    </td>

                </tr>

                <tr ng-if="sale.items.length === 0">
                    <td colspan="5" class="text-center text-muted">
                        No items added
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="mt-2">
            <button class="btn btn-outline-secondary btn-sm"
                    ng-click="addItem()">
                + Add Item
            </button>
        </div>

    </div>

    <!-- TOTAL & SAVE -->
    <div class="card mt-3">
        <div class="row align-items-center">

            <div class="col-md-6">
                <strong>Total Amount</strong>
            </div>

            <div class="col-md-6 text-end">
                <h5 class="mb-0">
                    ₹ {{ sale.total_amount | number:2 }}
                </h5>
            </div>

        </div>

        <div class="form-actions mt-3">
            <button class="btn btn-success"
                    ng-click="save()">
                Save Sale
            </button>
        </div>

        <p class="text-success mt-2" ng-if="message">
            {{ message }}
        </p>
    </div>

</div>
